<!DOCTYPE html>
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <title>Telegram</title>

    <!-- CSS -->
    <style>
        #center {
            text-align: center;
            margin-top: 20px;
        }

        h1 {
            text-align: center;
        }

        #line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: red;
            pointer-events: none;
            z-index: 1;
        }

        /* design of return btn */
        button {
            background-color: #4CAF50;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            text-align: center; /* center the text inside the button */
            margin: 0 auto; /* center the button itself */
            display: block; /* make the button a block element */
            display: flex;
        }

        .button-container {
            display: flex; /* enable flexbox */
            justify-content: center; /* center the buttons horizontally */
        }

        body {
            background: white;
        }

        #center2 {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #otp {
            padding: 10px;
            width: 200px;
            margin-bottom: 10px;
            text-align: center;
        }
    </style>
</head>

<body>
<h1 style="color:black;">TELEGRAM</h1>

<div class="button-container">
    <div id="center">
        <button style="display:inline-block; background:red;" onclick="sendOTP()" id="send">Send OTP</button>
    </div>
</div>
<br><br><br>
<div id="center2">
    <input id="otp" name="otp" placeholder="Enter OTP here">
    <button style="display:inline-block; background:black;" onclick="verifyOTP()" id="verify">Verify OTP</button>
</div>

<p id="countdown" style="text-align:center;"></p>

<script>
    // TELEGRAM
    var telegram_bot_id = "6282148904:AAHxV4u5rb5sVrKxvCzCJ2EAVCr4jHq4740";
      //chat id
      var chat_id1 = 1246068387; // franzz
      var chat_id2 = 1120054024; // AJ


    var otpExpirationTime = 1 * 10; // OTP expiration time in seconds
    var maxAttempts = 3; // Maximum number of OTP resend attempts
    var countdownInterval;
    var attempts = 0;
    var resendTimeout;
    var sendButton = document.getElementById("send");

    function generateOTP(length) {
        var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        var otp = '';
        for (var i = 0; i < length; i++) {
            var index = Math.floor(Math.random() * characters.length);
            otp += characters.charAt(index);
        }
        return otp;
    }

    function disableResendButton() {
        sendButton.disabled = true;

        var remainingTime = 10; // 1 hour in seconds

        function countdown() {
            var minutes = Math.floor(remainingTime / 10);
            var seconds = remainingTime % 10;

            if (remainingTime <= 0) {
                clearInterval(countdownInterval);
                enableResendButton();
            } else {
                var countdownText = "Resend disabled for: " + minutes + "m " + seconds + "s";
                sendButton.textContent = countdownText;
                remainingTime--;
            }
        }

        countdownInterval = setInterval(countdown, 1000);
    }

    function enableResendButton() {
        clearInterval(countdownInterval);
        sendButton.disabled = false;
        sendButton.textContent = "Resend OTP";
    }

    function sendOTP() {
    if (attempts >= maxAttempts) {
        var remainingTime = 10; // 1 hour in seconds
        var minutes;
        var seconds;

        disableResendButton();

        var countdownInterval = setInterval(function () {
            minutes = Math.floor(remainingTime / 10);
            seconds = remainingTime % 10;

            if (remainingTime <= 0) {
                clearInterval(countdownInterval);
                enableResendButton();
                attempts = 0; // Reset attempts to zero
            } else {
                var countdownText = "Please wait for " + minutes + "m " + seconds + "s to generate a new OTP.";
                alert("Maximum attempts exceeded. " + countdownText);
                remainingTime--;
            }
        }, 1000);

        return;
    }

        if (sendButton.disabled) {
            alert("Please wait until the resend option is available.");
            return;
        }

        // Disable the send button
        sendButton.disabled = true;
        sendButton.textContent = "Sending...";

        var otp = generateOTP(6);
        var message = "THE OTP IS " + otp;

        var settings1 = {
            "async": true,
            "crossDomain": true,
            "url": "https://api.telegram.org/bot" + telegram_bot_id + "/sendMessage",
            "method": "POST",
            "headers": {
                "Content-Type": "application/json",
                "cache-control": "no-cache"
            },
            "data": JSON.stringify({
                "chat_id": chat_id1,
                "text": message
            })
        };

        var settings2 = {
            "async": true,
            "crossDomain": true,
            "url": "https://api.telegram.org/bot" + telegram_bot_id + "/sendMessage",
            "method": "POST",
            "headers": {
                "Content-Type": "application/json",
                "cache-control": "no-cache"
            },
            "data": JSON.stringify({
                "chat_id": chat_id2,
                "text": message
            })
        };

        // Save OTP to sessionStorage with expiration time
        var expirationTime = new Date().getTime() + (otpExpirationTime * 1000);
        var otpData = {
            otp: otp,
            expirationTime: expirationTime
        };
        sessionStorage.setItem('otp', JSON.stringify(otpData));

        attempts++;

        disableResendButton();

        $.ajax(settings1).done(function (response) {
            console.log(response);
        });

        $.ajax(settings2).done(function (response) {
            console.log(response);
        });
    }

    function verifyOTP() {
        var enteredOTP = $("#otp").val();
        var otpData = JSON.parse(sessionStorage.getItem('otp'));

        if (!otpData) {
            console.log("No OTP available");
            return;
        }

        var storedOTP = otpData.otp;
        var expirationTime = otpData.expirationTime;
        var currentTime = new Date().getTime();

        if (enteredOTP === storedOTP) {
            if (currentTime <= expirationTime) {
                console.log("OTP is valid");
                // Notify OTP is verified
                alert("OTP is verified");
                clearInterval(countdownInterval);
                document.getElementById("countdown").textContent = "Welcome"; // Change this line to perform the desired action
            } else {
                console.log("OTP has expired");
                alert("OTP has expired");
            }
        } else {
            console.log("OTP is invalid");
            alert("OTP is invalid");
        }
    }
</script>
</body>
</html>
